# ğŸ¦ SÆ  Äá»’ Há»† THá»NG SHRIMP DETECTION

## ğŸ“Š SÆ  Äá»’ Tá»”NG QUAN Káº¾T Ná»I

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         ğŸŒ INTERNET / CLOUD                                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚  ğŸ”¥ Firebase    â”‚      â”‚  â˜ï¸ Cloudinary   â”‚      â”‚  ğŸ—„ï¸ MongoDB      â”‚ â•‘
â•‘  â”‚  Authentication â”‚      â”‚  Image Storage   â”‚      â”‚  Database        â”‚ â•‘
â•‘  â”‚                 â”‚      â”‚                  â”‚      â”‚                  â”‚ â•‘
â•‘  â”‚  â€¢ Google Auth  â”‚      â”‚  â€¢ Upload Images â”‚      â”‚  â€¢ Metadata      â”‚ â•‘
â•‘  â”‚  â€¢ ID Token     â”‚      â”‚  â€¢ CDN Delivery  â”‚      â”‚  â€¢ User Data     â”‚ â•‘
â•‘  â”‚  â€¢ User Email   â”‚      â”‚  â€¢ Public URLs   â”‚      â”‚  â€¢ Detection Log â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘          â–²                         â–²                         â–²            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•
           â”‚                         â”‚                         â”‚
           â”‚ ID Token                â”‚ Upload                  â”‚ Store
           â”‚ Verification            â”‚ Images                  â”‚ Metadata
           â”‚                         â”‚                         â”‚
â•”â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          â”‚                         â”‚                         â”‚            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚                  ğŸ FLASK BACKEND SERVER                            â”‚  â•‘
â•‘  â”‚                  (Raspberry Pi hoáº·c Server)                         â”‚  â•‘
â•‘  â”‚                                                                     â”‚  â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â•‘
â•‘  â”‚  â”‚          ğŸ” AUTHENTICATION & AUTHORIZATION                 â”‚    â”‚  â•‘
â•‘  â”‚  â”‚                                                            â”‚    â”‚  â•‘
â•‘  â”‚  â”‚  1. Verify Firebase ID Token                              â”‚    â”‚  â•‘
â•‘  â”‚  â”‚  2. Extract User Email                                    â”‚    â”‚  â•‘
â•‘  â”‚  â”‚  3. Check Permission Files:                               â”‚    â”‚  â•‘
â•‘  â”‚  â”‚     â€¢ permitted_emails.json (Whitelist)                   â”‚    â”‚  â•‘
â•‘  â”‚  â”‚     â€¢ permitted_devices.json (Device Bindings)            â”‚    â”‚  â•‘
â•‘  â”‚  â”‚  4. Grant Access (Admin or User)                          â”‚    â”‚  â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â•‘
â•‘  â”‚                                                                     â”‚  â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â•‘
â•‘  â”‚  â”‚ ğŸ“¹ Camera       â”‚  â”‚ ğŸ¤– YOLO Model    â”‚  â”‚ ğŸ“Š API Routes   â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ (USB/CSI)       â”‚  â”‚ (TFLite)         â”‚  â”‚                 â”‚   â”‚  â•‘
â•‘  â”‚  â”‚                 â”‚  â”‚                  â”‚  â”‚ â€¢ /blynk_feed   â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ Capture       â”‚  â”‚ â€¢ Detect Shrimp  â”‚  â”‚ â€¢ /api/detect   â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ Stream MJPEG  â”‚  â”‚ â€¢ Count & Label  â”‚  â”‚ â€¢ /api/devices  â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ Resolution    â”‚  â”‚ â€¢ Draw Boxes     â”‚  â”‚ â€¢ /api/admin    â”‚   â”‚  â•‘
â•‘  â”‚  â”‚   640x480       â”‚  â”‚ â€¢ Confidence     â”‚  â”‚ â€¢ /api/images   â”‚   â”‚  â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â•‘
â•‘  â”‚                                                                     â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                  â–²                                        â•‘
â•‘                                  â”‚                                        â•‘
â•‘                            HTTP Requests                                 â•‘
â•‘                            (with ID Token)                               â•‘
â•‘                                  â”‚                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                   â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                                â”‚
                   â”‚        ğŸ“± LOCAL NETWORK        â”‚
                   â”‚         (WiFi/LAN)             â”‚
                   â”‚                                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ğŸ“± ADMIN USER             â”‚   â”‚   ğŸ“± NORMAL USER          â”‚
    â”‚   Android App               â”‚   â”‚   Android App             â”‚
    â”‚                             â”‚   â”‚                           â”‚
    â”‚  Email: admin@gmail.com     â”‚   â”‚  Email: user@gmail.com    â”‚
    â”‚  Device: raspberrypi-001    â”‚   â”‚  Device: raspberrypi-001  â”‚
    â”‚                             â”‚   â”‚         (same device!)    â”‚
    â”‚  âœ… Full Permissions:        â”‚   â”‚                           â”‚
    â”‚  â€¢ View Camera Stream       â”‚   â”‚  âœ… Limited Permissions:   â”‚
    â”‚  â€¢ Capture & Detect         â”‚   â”‚  â€¢ View Camera Stream     â”‚
    â”‚  â€¢ View Gallery & Chart     â”‚   â”‚  â€¢ Capture & Detect       â”‚
    â”‚  â€¢ Bind/Unbind Device       â”‚   â”‚  â€¢ View Gallery & Chart   â”‚
    â”‚  â€¢ Add/Remove Users         â”‚   â”‚  â€¢ Bind/Unbind Device     â”‚
    â”‚  â€¢ Manage Email Whitelist   â”‚   â”‚                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” CHI TIáº¾T UDP DISCOVERY MECHANISM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Máº NG WIFI/LAN (192.168.1.x)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ğŸ“± Android App                           ğŸ“ Raspberry Pi              â”‚
â”‚   IP: 192.168.1.50                        IP: 192.168.1.100             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ User nháº¥n        â”‚                    â”‚ UDP Responder    â”‚          â”‚
â”‚   â”‚ "QuÃ©t thiáº¿t bá»‹"  â”‚                    â”‚ Thread running   â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ Port: 50000      â”‚          â”‚
â”‚            â”‚                              â””â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚            â”‚                                     â”‚                      â”‚
â”‚   STEP 1: Táº¡o UDP Socket                        â”‚                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                      â”‚
â”‚   â”‚ DatagramSocket sock              â”‚          â”‚                      â”‚
â”‚   â”‚ sock.broadcast = true            â”‚          â”‚                      â”‚
â”‚   â”‚ sock.timeout = 2000ms            â”‚          â”‚                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                      â”‚
â”‚            â”‚                                     â”‚                      â”‚
â”‚   STEP 2: Broadcast Message                     â”‚                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                      â”‚
â”‚   â”‚ Message: "DISCOVER_RASP"         â”‚          â”‚                      â”‚
â”‚   â”‚ Destination: 255.255.255.255     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚   â”‚ Port: 50000                      â”‚ UDP      â”‚                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Packet   â”‚                      â”‚
â”‚                                         â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                      â”‚
â”‚                                                  â”‚                      â”‚
â”‚                                         STEP 3: Raspberry Pi nháº­n       â”‚
â”‚                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                                         â”‚ Receive: DISCOVER_RASPâ”‚       â”‚
â”‚                                         â”‚ From: 192.168.1.50    â”‚       â”‚
â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                  â”‚                      â”‚
â”‚                                         STEP 4: Prepare Response        â”‚
â”‚                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                                         â”‚ device_id = "rasp-001"â”‚       â”‚
â”‚                                         â”‚ Send to 192.168.1.50  â”‚       â”‚
â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                  â”‚                      â”‚
â”‚   STEP 5: App nháº­n response          UDP        â”‚                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Response â”‚                      â”‚
â”‚   â”‚ sock.receive(response)           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚   â”‚ Data: "raspberrypi-001"          â”‚          â”‚                      â”‚
â”‚   â”‚ From IP: 192.168.1.100           â”‚          â”‚                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                      â”‚
â”‚            â”‚                                     â”‚                      â”‚
â”‚   STEP 6: Hiá»ƒn thá»‹ trong UI                     â”‚                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                      â”‚
â”‚   â”‚ foundDevices.add(                â”‚          â”‚                      â”‚
â”‚   â”‚   "192.168.1.100" to             â”‚          â”‚                      â”‚
â”‚   â”‚   "raspberrypi-001"              â”‚          â”‚                      â”‚
â”‚   â”‚ )                                â”‚          â”‚                      â”‚
â”‚   â”‚                                  â”‚          â”‚                      â”‚
â”‚   â”‚ UI shows:                        â”‚          â”‚                      â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚          â”‚                      â”‚
â”‚   â”‚ â”‚ raspberrypi-001              â”‚ â”‚          â”‚                      â”‚
â”‚   â”‚ â”‚ 192.168.1.100                â”‚ â”‚          â”‚                      â”‚
â”‚   â”‚ â”‚ [Káº¿t ná»‘i]                    â”‚ â”‚          â”‚                      â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚          â”‚                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ LÆ¯U Ã:
â€¢ UDP Broadcast chá»‰ hoáº¡t Ä‘á»™ng trong CÃ™NG Máº NG LOCAL (khÃ´ng qua Internet)
â€¢ Náº¿u cÃ³ nhiá»u Raspberry Pi, táº¥t cáº£ sáº½ pháº£n há»“i â†’ App hiá»ƒn thá»‹ danh sÃ¡ch
â€¢ Sau khi bind xong, cÃ³ thá»ƒ dÃ¹ng Ngrok Ä‘á»ƒ truy cáº­p tá»« xa (khÃ´ng cáº§n UDP ná»¯a)
â€¢ Timeout 2 giÃ¢y: Náº¿u khÃ´ng cÃ³ pháº£n há»“i â†’ "KhÃ´ng tÃ¬m tháº¥y thiáº¿t bá»‹"
```

---

## ğŸ” SÆ  Äá»’ PHÃ‚N QUYá»€N ADMIN vs USER

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER LOGIN (Google)                             â”‚
â”‚                                                                         â”‚
â”‚  User má»Ÿ app â†’ ÄÄƒng nháº­p Google â†’ Firebase Auth táº¡o ID Token           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               BACKEND VERIFIES TOKEN & CHECKS PERMISSION                â”‚
â”‚                                                                         â”‚
â”‚  1. Extract ID Token from Authorization: Bearer <token>                 â”‚
â”‚  2. firebase_auth.verify_id_token(token) â†’ decoded_token                â”‚
â”‚  3. user_email = decoded_token['email']                                 â”‚
â”‚  4. Load permitted_emails.json                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                              â”‚
           âŒ Email NOT in list          âœ… Email IN list
                    â”‚                              â”‚
                    â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ğŸš« ACCESS DENIED         â”‚    â”‚  Check if Admin:           â”‚
    â”‚                           â”‚    â”‚  email == ADMIN_EMAIL?     â”‚
    â”‚  Response: 403 Forbidden  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  Message: "TÃ i khoáº£n chÆ°a â”‚             â”‚          â”‚
    â”‚  Ä‘Æ°á»£c cáº¥p quyá»n. LiÃªn há»‡  â”‚        YES  â”‚          â”‚  NO
    â”‚  admin Ä‘á»ƒ Ä‘Æ°á»£c cáº¥p quyá»n."â”‚             â”‚          â”‚
    â”‚                           â”‚             â–¼          â–¼
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚ ğŸ‘‘ ADMIN   â”‚  â”‚ ğŸ‘¤ USER  â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ğŸ‘‘ ADMIN PERMISSIONS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  âœ… Core Features:                                                      â”‚
â”‚     â€¢ View Camera Stream (Real-time MJPEG)                              â”‚
â”‚     â€¢ Capture Photos                                                    â”‚
â”‚     â€¢ AI Shrimp Detection & Counting                                    â”‚
â”‚     â€¢ View Detection Gallery (Grid View)                                â”‚
â”‚     â€¢ View Statistics Chart                                             â”‚
â”‚     â€¢ Bind/Unbind Device (QR Scan)                                      â”‚
â”‚                                                                         â”‚
â”‚  âœ… Admin-Only Features:                                                â”‚
â”‚     â€¢ View All Permitted Emails (GET /api/admin/emails)                 â”‚
â”‚     â€¢ Add User to Whitelist (POST /api/admin/emails/add)                â”‚
â”‚     â€¢ Remove User from Whitelist (POST /api/admin/emails/remove)        â”‚
â”‚     â€¢ System Management                                                 â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“± UI Display:                                                         â”‚
â”‚     â€¢ "Admin Panel" button visible in Profile screen                    â”‚
â”‚     â€¢ Email management interface                                        â”‚
â”‚     â€¢ Full system access                                                â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ğŸ‘¤ USER PERMISSIONS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  âœ… Core Features:                                                      â”‚
â”‚     â€¢ View Camera Stream (Real-time MJPEG)                              â”‚
â”‚     â€¢ Capture Photos                                                    â”‚
â”‚     â€¢ AI Shrimp Detection & Counting                                    â”‚
â”‚     â€¢ View Detection Gallery (Grid View)                                â”‚
â”‚     â€¢ View Statistics Chart                                             â”‚
â”‚     â€¢ Bind/Unbind Device (QR Scan - Own Device Only)                    â”‚
â”‚                                                                         â”‚
â”‚  âŒ Cannot Access:                                                      â”‚
â”‚     â€¢ Admin Panel (Hidden in UI)                                        â”‚
â”‚     â€¢ Email Management APIs (403 Forbidden)                             â”‚
â”‚     â€¢ Other Users' Device Info                                          â”‚
â”‚     â€¢ System Configuration                                              â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“± UI Display:                                                         â”‚
â”‚     â€¢ Standard user interface                                           â”‚
â”‚     â€¢ No admin controls visible                                         â”‚
â”‚     â€¢ Personal device management only                                   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ LUá»’NG Káº¾T Ná»I DEVICE (Device Binding Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  STEP 1: USER QUÃ‰T WIFI (UDP BROADCAST)                 â”‚
â”‚                                                                         â”‚
â”‚  User nháº¥n "QuÃ©t thiáº¿t bá»‹" trong Profile Screen                         â”‚
â”‚                                                                         â”‚
â”‚  App gá»­i UDP Broadcast:                                                 â”‚
â”‚  â€¢ Message: "DISCOVER_RASP"                                             â”‚
â”‚  â€¢ Port: 50000                                                          â”‚
â”‚  â€¢ Broadcast IP: 255.255.255.255                                        â”‚
â”‚  â€¢ Timeout: 2 seconds                                                   â”‚
â”‚                                                                         â”‚
â”‚  âš ï¸ YÃŠU Cáº¦U: App vÃ  Raspberry Pi pháº£i CÃ™NG Máº NG WIFI/LAN                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  RASPBERRY PI PHáº¢N Há»’I (UDP RESPONSE)                   â”‚
â”‚                                                                         â”‚
â”‚  Raspberry Pi nháº­n "DISCOVER_RASP" â†’ Tráº£ lá»i:                           â”‚
â”‚  â€¢ Device ID: "raspberrypi-001"                                         â”‚
â”‚  â€¢ IP address: 192.168.1.100                                            â”‚
â”‚                                                                         â”‚
â”‚  App hiá»ƒn thá»‹ danh sÃ¡ch thiáº¿t bá»‹ tÃ¬m Ä‘Æ°á»£c:                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ ğŸ“± Thiáº¿t bá»‹ tÃ¬m tháº¥y:                   â”‚                           â”‚
â”‚  â”‚ â€¢ raspberrypi-001 (192.168.1.100)       â”‚                           â”‚
â”‚  â”‚ â€¢ raspberrypi-002 (192.168.1.101)       â”‚                           â”‚
â”‚  â”‚   [Káº¿t ná»‘i]                             â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  STEP 2: SEND BIND REQUEST                              â”‚
â”‚                                                                         â”‚
â”‚  User chá»n device â†’ App gá»­i bind request:                               â”‚
â”‚                                                                         â”‚
â”‚  POST http://192.168.1.100:8000/api/devices/bind                        â”‚
â”‚  Headers: Authorization: Bearer <firebase_id_token>                     â”‚
â”‚  Body: {                                                                â”‚
â”‚    "device_id": "raspberrypi-001",                                      â”‚
â”‚    "ip": "192.168.1.100"                                                â”‚
â”‚  }                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  STEP 3: BACKEND PROCESSES BINDING                      â”‚
â”‚                                                                         â”‚
â”‚  1. Verify ID Token â†’ Extract Email                                     â”‚
â”‚  2. Check if email in permitted_emails.json                             â”‚
â”‚  3. Update permitted_devices.json:                                      â”‚
â”‚     {                                                                   â”‚
â”‚       "user@gmail.com": {                                               â”‚
â”‚         "device_id": "raspberrypi-001",                                 â”‚
â”‚         "ip": "192.168.1.100",                                          â”‚
â”‚         "last_updated": 1735286400                                      â”‚
â”‚       }                                                                 â”‚
â”‚     }                                                                   â”‚
â”‚  4. Response: 200 OK                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  STEP 4: USER CAN NOW ACCESS DEVICE                     â”‚
â”‚                                                                         â”‚
â”‚  â€¢ View Camera Stream: GET /blynk_feed                                  â”‚
â”‚  â€¢ Capture & Detect: POST /api/detect-shrimp                            â”‚
â”‚  â€¢ View Gallery: GET /api/shrimp-images                                 â”‚
â”‚  â€¢ View Chart: GET /api/shrimp-count-by-time                            â”‚
â”‚                                                                         â”‚
â”‚  âš ï¸ NOTE: Multiple users can bind to SAME device independently!         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š LUá»’NG Dá»® LIá»†U CAPTURE & DETECTION

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: User nháº¥n "Capture" button trÃªn Android App                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: POST /api/detect-shrimp                                        â”‚
â”‚          Headers: Authorization: Bearer <token>                         â”‚
â”‚          (Image tá»« camera stream)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: BACKEND PROCESSING                                             â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 1. Capture frame tá»« camera                                  â”‚       â”‚
â”‚  â”‚ 2. Resize áº£nh vá» 640x640 (YOLO input)                       â”‚       â”‚
â”‚  â”‚ 3. Run TFLite model (YOLO)                                  â”‚       â”‚
â”‚  â”‚ 4. Parse detections:                                        â”‚       â”‚
â”‚  â”‚    â€¢ Bounding boxes (x, y, w, h)                            â”‚       â”‚
â”‚  â”‚    â€¢ Confidence scores                                      â”‚       â”‚
â”‚  â”‚    â€¢ Class labels                                           â”‚       â”‚
â”‚  â”‚ 5. Draw boxes & labels trÃªn áº£nh                             â”‚       â”‚
â”‚  â”‚ 6. Count total shrimps detected                             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: UPLOAD TO CLOUD                                                â”‚
â”‚                                                                         â”‚
â”‚  â€¢ Upload annotated image â†’ Cloudinary                                  â”‚
â”‚  â€¢ Get public URL (CDN)                                                 â”‚
â”‚  â€¢ Save metadata â†’ MongoDB:                                             â”‚
â”‚    {                                                                    â”‚
â”‚      "image_url": "https://cloudinary.com/...",                         â”‚
â”‚      "shrimp_count": 15,                                                â”‚
â”‚      "timestamp": "2025-12-27T10:30:00",                                â”‚
â”‚      "user_email": "user@gmail.com",                                    â”‚
â”‚      "detection_results": [...]                                         â”‚
â”‚    }                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: RETURN TO APP                                                  â”‚
â”‚                                                                         â”‚
â”‚  Response:                                                              â”‚
â”‚  {                                                                      â”‚
â”‚    "annotated_image": "https://cloudinary.com/...",                     â”‚
â”‚    "shrimp_count": 15,                                                  â”‚
â”‚    "detection_results": [                                               â”‚
â”‚      {"x": 100, "y": 150, "w": 50, "h": 60, "confidence": 0.95},       â”‚
â”‚      ...                                                                â”‚
â”‚    ]                                                                    â”‚
â”‚  }                                                                      â”‚
â”‚                                                                         â”‚
â”‚  App hiá»ƒn thá»‹ áº£nh + sá»‘ lÆ°á»£ng tÃ´m + bounding boxes                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ KEY FEATURES

### 1ï¸âƒ£ **Independent Device Binding**
- Nhiá»u user cÃ³ thá»ƒ bind cÃ¹ng 1 device váº­t lÃ½
- Má»—i user cÃ³ binding riÃªng, khÃ´ng áº£nh hÆ°á»Ÿng láº«n nhau
- Unbind cá»§a user A khÃ´ng áº£nh hÆ°á»Ÿng user B

### 2ï¸âƒ£ **Two-Tier Permission System**
- **Admin**: Email Ä‘Æ°á»£c set trong `.env` (ADMIN_EMAIL)
  - Full quyá»n quáº£n lÃ½ system
  - Add/remove users
  - Email management API
  
- **User**: Email Ä‘Æ°á»£c admin thÃªm vÃ o whitelist
  - Core features: camera, detect, gallery, chart
  - Personal device management
  - KhÃ´ng truy cáº­p admin APIs

### 3ï¸âƒ£ **Firebase Authentication**
- Google Sign-In for easy login
- ID Token for secure API access
- Server-side token verification
- No password management needed

### 4ï¸âƒ£ **UDP Device Discovery**
- App broadcast "DISCOVER_RASP" message (port 50000)
- Raspberry Pi pháº£n há»“i vá»›i Device ID + IP
- Tá»± Ä‘á»™ng tÃ¬m thiáº¿t bá»‹ trong cÃ¹ng máº¡ng WiFi/LAN
- Timeout 2 seconds cho quÃ¡ trÃ¬nh scan
- âš ï¸ YÃªu cáº§u: App vÃ  Rasp CÃ™NG Máº NG

### 5ï¸âƒ£ **Real-time Camera Streaming**
- MJPEG stream over HTTP
- Low latency (~1 second)
- 640x480 @ 30fps
- Works on local network

### 6ï¸âƒ£ **AI Shrimp Detection**
- YOLO model (TFLite format)
- Object detection + counting
- Bounding box visualization
- Confidence scores
- Fast inference (~100-200ms)

### 7ï¸âƒ£ **Cloud Storage**
- Cloudinary for images (CDN)
- MongoDB for metadata
- Persistent storage
- Fast retrieval

---

## ğŸ”§ TECHNOLOGY STACK

### ğŸ“± **Android App**
- Language: Kotlin
- UI: Jetpack Compose
- Auth: Firebase Authentication
- HTTP: Retrofit/OkHttp
- Camera: CameraX / External stream
- Charts: MPAndroidChart / Compose Charts

### ğŸ **Backend Server**
- Framework: Flask (Python)
- Auth: Firebase Admin SDK
- Camera: OpenCV (cv2)
- AI: TFLite (YOLO model)
- Image: Cloudinary SDK
- Database: PyMongo (MongoDB)
- CORS: Flask-CORS

### â˜ï¸ **Cloud Services**
- Firebase: Authentication
- Cloudinary: Image CDN
- MongoDB Atlas: Database

---

## ğŸ“ GHI CHÃš QUAN TRá»ŒNG

1. **Device ID lÃ  KEY cho binding**, khÃ´ng pháº£i device váº­t lÃ½
2. **CÃ¹ng 1 Raspberry Pi** cÃ³ thá»ƒ Ä‘Æ°á»£c bind bá»Ÿi nhiá»u users
3. **Admin email** Ä‘Æ°á»£c define trong `.env`, khÃ´ng thá»ƒ thay Ä‘á»•i tá»« API
4. **Permitted emails** Ä‘Æ°á»£c manage qua admin APIs hoáº·c file JSON
5. **ID Token** pháº£i gá»­i kÃ¨m trong má»—i request (Authorization header)
6. **UDP Discovery** (QuÃ©t WiFi):
   - âš ï¸ **CÃ™NG Máº NG WIFI/LAN** báº¯t buá»™c cho láº§n Ä‘áº§u bind
   - App broadcast "DISCOVER_RASP" â†’ Rasp pháº£n há»“i
   - Port: 50000, Timeout: 2 seconds
   - KhÃ´ng cáº§n QR code hay nháº­p IP thá»§ cÃ´ng
7. **Sau khi bind**: CÃ³ thá»ƒ dÃ¹ng Ngrok/VPN Ä‘á»ƒ truy cáº­p tá»« xa

